# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/blocks/index.css — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: TCategory;
    price: TPrice;
}
```

Категория товара

```
type TCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Тип цены

```
type TPrice = number | null;
```

Способ оплаты

```
type TPayment = 'Онлайн' | 'При получении' | null;
```

Представления товара

```
type TItemMain = Pick<IItem, 'title' | 'category' | 'image' | 'price'>; 

type TItemModal = Pick<IItem, 'title' | 'category' | 'description' | 'image' | 'price'>; 

type TItemBasket = Pick<IItem, 'id' | 'title' | 'price'>; 
```

Данные формы заказа

```
interface IOrderForm {
    payment: TPayment;
    address: string;
    email: string;
    phone: string;
}
```

Заказ

```
interface IOrder extends IOrderForm {
    items: string[];
    total: TPrice;
}
```

Представления данных форм

```
type IDeliveryForm = Pick<IOrderForm, 'payment' | 'address'>;

type IContactsForm = Pick<IOrderForm, 'email' | 'phone'>;
```

## Архитектура приложения

Приложение построено по архитектуре MVP (Model - View - Presenter). Эта архитектура делит систему на независимые слои: 
- Модель (Model) - отвечает за хранение и изменение данных 
- Представление (View) - представления, отвечает за отображение данных на странице
- Презентер (Presenter) - презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит логику HTTP-запросов. В конструктор передаётся базовый URL и опциональные заголовки.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CatalogModel
Класс отвечает за хранение и логику работы с данными товаров, полученных от API.\
Конструктор класса принимает инстант брокера событий.
В полях класса хранятся следующие данные:
- _items: IItem[] - массив всех товаров
- _preview: string | null - id товара, выбранной для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getItem(id: string): IItem | null — возвращает товар по ID;
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BasketModel
Класс отвечает за хранение и логику работы с корзиной.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _items: Set<string> — множество ID товаров, добавленных в корзину (исключает дубликаты);
- events: IEvents — экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет следующие методы:
- addItem(id: string): void — добавляет товар в корзину;
- removeItem(id: string): void — удаляет товар из корзины;
- calculateTotal(): TPrice — вычисляет общую стоимость товаров в корзине;
- getCount(): number — возвращает количество товаров в корзине
- clear(): void — очищает корзину.
- сеттер и геттер для безопасного доступа и изменения items

#### Класс OrderModel
Класс отвечает за хранение и логику работы с данными клиента.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- _order: IOrder — объект с данными заказа.
- events: IEvents — экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет набор методов и свойств для взаимодействия с этими данными:
- setItems(items: Partial<IOrder>): void — сохраняет список товаров и общую сумму в заказе.  
- setFormData(data: Partial<IOrderForm>): void — добавляет или обновляет данные формы (оплата, адрес, контакты).  
- validateStep(formPart: Partial<IOrderForm>): string | null — проверяет корректность указанной части формы и возвращает сообщение об ошибке либо null.  
- reset(): void — очищает заказ и сбрасывает все данные формы.  
- сеттеры и геттеры для безопасного доступа и обновления order

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс View
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс ModalView
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(modal: HTMLElement, events: IEvents) Конструктор принимает элемент разметки модального окна, и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- content: HTMLElement - содержимое модального окна
- closeButton: HTMLButtonElement - кнопка закрытия модального окна
- events: IEvents - брокер событий

Класс предоставляет следующие методы:
- bindEvents(): void - устанавливает обработчики событий для закрытия окна по кнопке, клику на оверлей и нажатию клавиши Esc.
- open(): void - открывает модальное окно
- close(): void - закрывает модально окно
- setContent(content: HTMLElement): void - заменяет содержимое модального окна на переданный элемент.
- clearContent(): void - очищает содержимое модального окна

#### Класс FormView
Класс реализует отображение и взаимодействие с формой оформления заказа. Поддерживает пошаговое заполнение, валидацию полей ввода и генерацию событий для презентера.
 
- constructor(form: HTMLFormElement, events: IEvents) — принимает DOM-элемент формы, и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- form: HTMLFormElement — элемент формы
- submitButton: HTMLButtonElement — кнопка отправки формы
- errorContainer: HTMLElement — элемент где выводятся ошибки валидации
- events: IEvents — брокер событий для взаимодействия с презентером

Класс предоставляет следующие методы:
- handleClick(event: Event): void — обрабатывает выбор способа оплаты.
- handleInput(): void — сообщает презентеру, что данные формы изменились.
- handleSubmit(event: Event): void — генерирует событие form:submit с введёнными данными.
- toggleSubmit(isActive: boolean): void — включает/выключает кнопку.
- showError(message: string): void — показывает ошибку рядом с кнопкой.
- clearError(): void — убирает ошибку.
- collectData(): IOrderForm — собирает данные формы.
- reset(): void — очищает форму и отключает кнопку.

#### Класс CardCatalogView

Класс отвечает за отображение карточки товара в каталоге.
Предоставляет статичную информацию о товаре: категорию, название, цену и изображение.
Может использоваться для рендера списка товаров и навешивания обработчиков открытия предпросмотра.

#### Класс CardPreviewView

Класс реализует расширенный просмотр карточки товара.
Отображает полное описание продукта, категорию, цену и кнопку для добавления товара в корзину.
Обеспечивает взаимодействие пользователя с каталогом, позволяя перейти от просмотра к покупке.

#### Класс CardBasketView

Класс отображает компактную карточку товара в корзине.
Содержит индекс позиции, название товара, цену и кнопку удаления.
Отвечает за удобное представление содержимого корзины и взаимодействие пользователя с отдельными товарами.

#### Класс BasketView

Класс отображает содержимое корзины в модальном окне.
Отвечает за отрисовку списка товаров, добавленных пользователем, и вывод итоговой стоимости.
Позволяет оформить заказ и очистить корзину через взаимодействие с кнопками.

#### Класс SuccessView

Класс отображает финальный экран успешного оформления заказа.
Содержит сообщение об успешной покупке и итоговую сумму заказа.
Предлагает пользователю вернуться в каталог для совершения новых покупок.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\

| Событие                   | Описание                                  |
| ------------------------- | ----------------------------------------- |
| `catalog:preview`         | пользователь выбрал товар                 |
| `catalog:clear-preview`   | пользователь закрыл модальное окно товара |
| `basket:changed`          | изменился состав корзины                  |
| `basket:item-added`       | товар добавлен в корзину                  |
| `basket:item-removed`     | товар удалён из корзины                   |
| `basket:cleared`          | корзина полностью очищена                 |
| `basket:open`             | пользователь открыл корзину               |
| `basket:checkout`         | пользователь перешёл к заполнению формы   |
| `form:updated`            | обновились данные формы                   |
| `form:validated-step`     | валидация текущего шага формы             |
| `form:submit`             | пользователь подтвердил оформление заказа |
| `modal:open`              | модальное окно открылось                  |
| `modal:close`             | модальное окно закрылось                  |
| `modal:content-changed`   | сменилось содержимое модального окна      |
| `order:success`           | заказ успешно оформлен                    |
| `order:failed`            | ошибка оформления заказа                  |
