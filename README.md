# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/blocks/index.css — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: TCategory;
    price: TPrice;
}
```

Категория товара

```
type TCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Тип цены

```
type TPrice = number | null;
```

Способ оплаты

```
type TPayment = 'online' | 'offline' | null;
```

Представления товара

```
type TItemMain = Pick<IItem, 'title' | 'category' | 'image' | 'price'>; 

type TItemModal = Pick<IItem, 'title' | 'category' | 'description' | 'image' | 'price'>; 

type TItemBasket = Pick<IItem, 'id' | 'title' | 'price'>; 
```

Данные формы заказа

```
interface IOrderForm {
    payment: TPayment;
    address: string;
    email: string;
    phone: string;
}
```

Представления данных форм

```
type TDeliveryForm = Pick<IOrderForm, 'payment' | 'address'>;

type TContactsForm = Pick<IOrderForm, 'email' | 'phone'>;
```

## Архитектура приложения

Приложение построено по архитектуре MVP (Model - View - Presenter). Эта архитектура делит систему на независимые слои: 
- Модель (Model) - отвечает за хранение и изменение данных 
- Представление (View) - представления, отвечает за отображение данных на странице
- Презентер (Presenter) - презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит логику HTTP-запросов. В конструктор передаётся базовый URL и опциональные заголовки.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CatalogModel
Класс отвечает за хранение и логику работы с данными товаров, полученных от API.\
Конструктор класса принимает инстант брокера событий.
В полях класса хранятся следующие данные:
- _items: IItem[] - массив всех товаров
- _preview: string | null - id товара, выбранной для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getItem(id: string): IItem — возвращает товар по ID;
- clearPreview(): void — очищает поле preview;
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BasketModel
Класс отвечает за хранение и логику работы с корзиной.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _items: Set<string> — множество ID товаров, добавленных в корзину (исключает дубликаты);
- events: IEvents — экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет следующие методы:
- addItem(id: string): void — добавляет товар в корзину;
- removeItem(id: string): void — удаляет товар из корзины;
- calculateTotal(): TPrice — вычисляет общую стоимость товаров в корзине;
- getCount(): number — возвращает количество товаров в корзине
- clear(): void — очищает корзину.
- сеттер и геттер для безопасного доступа и изменения items

#### Класс OrderModel
Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- _orderForm: IOrderForm — объект с данными заказа.
- events: IEvents — экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет набор методов и свойств для взаимодействия с этими данными:
- reset(): void — очищает заказ и сбрасывает все данные формы.
- checkValidation — валидириует поля формы заказа.
- сеттеры и геттеры для безопасного доступа и обновления order

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс View
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс PageView
Класс управляет основной страницей интернет-магазина. Отвечает за отображение каталога товаров, работу со счётчиком корзины и блокировку прокрутки при открытых модальных окнах.

Поля класса:
counter: HTMLElement — элемент со счётчиком количества товаров в корзине.
wrapper: HTMLElement — корневой контейнер страницы.
basket: HTMLElement — кнопка корзины.
events: IEvents — брокер событий для связи с презентером.

Методы:
setCounter(value: number): void — обновляет значение счётчика товаров в корзине.
setLocked(value: boolean): void — включает или отключает блокировку прокрутки страницы.

#### Класс CatalogView
Класс управляет отображением списка карточек товаров на главной странице. Используется внутри PageView.

Поля класса:
container: HTMLElement — контейнер для карточек каталога.

Методы:
render(items: HTMLElement[]): void — заменяет текущее содержимое каталога новым списком карточек.

#### Класс CardCatalogView
Класс отвечает за отображение карточки товара в каталоге и открытие предпросмотра при клике.

Поля класса:
title: HTMLElement — название товара.
price: HTMLElement — цена товара.
category: HTMLElement — категория товара.
image: HTMLImageElement — изображение товара.

Методы:
render(data: TItemMain): HTMLElement — рендерит карточку товара.

#### Класс CardModalView
Класс реализует модальное окно предпросмотра товара.

Поля класса:
title: HTMLElement — название товара.
price: HTMLElement — цена товара.
category: HTMLElement — категория товара.
description: HTMLElement — описание товара.
image: HTMLImageElement — изображение товара.
actionButton: HTMLButtonElement — кнопка «Купить» / «Убрать».

Методы:
render(data: TItemModal): HTMLElement — рендерит предпросмотр товара.
setButtonState(inBasket: boolean): void — изменяет текст кнопки в зависимости от того, в корзине ли товар.

#### Класс ModalView
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(modal: HTMLElement, events: IEvents) Конструктор принимает элемент разметки модального окна, и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- content: HTMLElement - содержимое модального окна
- closeButton: HTMLButtonElement - кнопка закрытия модального окна
- events: IEvents - брокер событий

Класс предоставляет следующие методы:
- bindEvents(): void - устанавливает обработчики событий для закрытия окна по кнопке, клику на оверлей и нажатию клавиши Esc.
- open(): void - открывает модальное окно
- close(): void - закрывает модально окно
- setContent(content: HTMLElement): void - заменяет содержимое модального окна на переданный элемент.
- clearContent(): void - очищает содержимое модального окна

#### Класс BasketView
Класс отображает корзину с товарами в модальном окне.

Поля класса:
- list: HTMLElement — контейнер для списка товаров.
- total: HTMLElement — элемент с итоговой стоимостью заказа.
- orderButton: HTMLButtonElement — кнопка «Оформить заказ».

Методы:
render(data: IOrderBasket): HTMLElement — рендерит список товаров и итоговую стоимость.

#### Класс CardBasketView
Класс отображает товар в корзине.

Поля класса:
- index: HTMLElement — порядковый номер товара в корзине.
- title: HTMLElement — название товара.
- price: HTMLElement — цена товара.
- removeButton: HTMLButtonElement — кнопка удаления товара.

Методы:
render(data: TItemBasket): HTMLElement — рендерит товар в корзине.

#### Класс FormView
Базовое представление формы. Отвечает за обработку событий ввода и отправки, управление состоянием валидации и отображение ошибок. Является универсальным компонентом, от которого наследуются все конкретные формы заказа.
 
- constructor(form: HTMLFormElement, events: IEvents) — принимает DOM-элемент формы, и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- form: HTMLFormElement — элемент формы
- submitButton: HTMLButtonElement — кнопка отправки формы
- errorContainer: HTMLElement — элемент где выводятся ошибки
- events: IEvents — брокер событий для взаимодействия с презентером

Класс предоставляет следующие методы:
- setValid(isValid: boolean): void — изменяет активность кнопки подтверждения.
- showError(errorMessage: string): void — отображает сообщение об ошибке.
- hideError(): void — скрывает сообщение об ошибке.

#### Класс DeliveryFormView
Класс реализует отображение и взаимодействие с формой первого шага заказа (выбор способа оплаты и адреса).

Поля класса:
- paymentButtons: NodeListOf<HTMLButtonElement> — кнопки для выбора способа оплаты.
- addressInput: HTMLInputElement — поле ввода адреса доставки.
- selectedPayment: TPayment | null — выбранный способ оплаты.

Методы:
- collectData(): TDeliveryForm — возвращает данные формы.
- onPaymentSelect(payment: TPayment): void — обрабатывает выбор способа оплаты.

#### Класс ContactsFormView
Класс реализует отображение и взаимодействие с формой второго шага заказа (ввод почты и телефона).

Поля класса:
- emailInput: HTMLInputElement — поле для ввода email.
- phoneInput: HTMLInputElement — поле для ввода телефона.

Методы:
collectData(): TContactForm — возвращает данные формы.

#### Класс SuccessView
Класс отображает финальный экран успешного оформления заказа.

Поля класса:
message: HTMLElement — сообщение об успехе.
total: HTMLElement — элемент с итоговой суммой заказа.
backButton: HTMLButtonElement — кнопка возврата в каталог.

Методы:
render(data: ISuccess): HTMLElement — рендерит сообщение об успешной покупке и итоговую сумму.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\

| Событие                   | Описание                                  |
| ------------------------- | ----------------------------------------- |
| `catalog:preview`         | пользователь выбрал товар                 |
| `catalog:clear-preview`   | пользователь закрыл модальное окно товара |
| `basket:changed`          | изменился состав корзины                  |
| `basket:item-added`       | товар добавлен в корзину                  |
| `basket:item-removed`     | товар удалён из корзины                   |
| `basket:cleared`          | корзина полностью очищена                 |
| `basket:open`             | пользователь открыл корзину               |
| `basket:checkout`         | пользователь перешёл к заполнению формы   |
| `form:updated`            | обновились данные формы                   |
| `form:cleared`     | форма очищена              |
| `form:submit`             | пользователь подтвердил оформление заказа |
| `modal:open`              | модальное окно открылось                  |
| `modal:close`             | модальное окно закрылось                  |
| `modal:content-changed`   | сменилось содержимое модального окна      |
| `order:success`           | заказ успешно оформлен                    |
| `order:failed`            | ошибка оформления заказа                  |
